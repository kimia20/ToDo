@inherits LayoutComponentBase
@inject NavigationManager NavigationManager
@inject WebEndpoints.ToDo.UI.Services.CustomStateProvider AuthState
@inject IJSRuntime jsr

<div class="page">
    <div class="sidebar">
        <NavMenu />
    </div>

    <main>
        <div class="top-row px-4">
            <a href="https://docs.microsoft.com/aspnet/" target="_blank">About</a>
        </div>

        <article class="content px-4">
            @Body
        </article>
    </main>
</div>
@code {
    string userdata;

    private async Task<string> GetJWT()
    {
        userdata = await jsr.InvokeAsync<string>("localStorage.getItem", "user").ConfigureAwait(false);
        if (!string.IsNullOrWhiteSpace(userdata))
        {
            var dataArray = userdata.Split(';', 2);
            if (dataArray.Length == 2)
                return dataArray[1];
        }
        return null;
    }

    protected async override Task OnInitializedAsync()
    {
        base.OnInitialized();
        try
        {
            var result = await GetJWT();
            if (result == null)
            {
                //Console.WriteLine($"{user.Identity.IsAuthenticated}");
                NavigationManager.NavigateTo($"/login");
              
            }
            else
            {
                Console.WriteLine("My debug output.");
            }
            //var user = (await AuthState.GetAuthenticationStateAsync())?.User;
            //if (user == null)
            //{
               
            //}
            //if (!user.Identity.IsAuthenticated)
            //{
                
                
            //}
        }
        catch (Exception ex)
        {
            Console.WriteLine($"{ex.Message},{ex.InnerException}");
        }
       
    }
}